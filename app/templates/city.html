{% extends 'base.html' %}

{% block title %}
    职位页
{% endblock %}

{% block content %}

    <div id="main" style="width: 100%;height:700px;position: absolute;top: 50px;"></div>

{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));


        // 指定图表的配置项和数据
        var option = {
            {#backgroundColor: '#b5ad48',#}

            title: {
                subtext: 'data from lagou.com',
                sublink: 'http://www.lagou.com',
                left: 'center'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            legend: {
                left: 'left',
                orient: 'vertical',
                data: []
            },
            series: [{
                name: '数量（占比）',
                type: 'pie',
                radius: '55%',
                center: ['50%', '60%'],
                data: [],
                itemStyle: {
                    emphasis: {
                        shadowBlur: 10,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                }
            }]
        };
        myChart.setOption(option);

        {# 异步加载数据 #}
        myChart.showLoading();
        var names = [];
        var nums = [];
        var selected = {};
        $.ajax({
            type: "get",
            url: "/position/city_json/",
            dataType: "json",
            success: function (result) {
                if (result) {
                    for (var i = 0; i < result["data"].length; i++) {
                        key = (result["data"][i]["name"]);
                        num = (result["data"][i]["value"]);
                        names.push(key);
                        nums.push(num);
                        _min = result["num"] / 100;
                        if (num < _min) {
                            selected[key] = false
                        }

                    }
                    myChart.hideLoading();
                    myChart.setOption({
                        title:{
                            text: result['keyword'] + '职位城市分布图'
                        },
                        series: {
                            data: result["data"]
                        },
                        legend: {
                            data: names,
                            selected: selected
                        }
                    });
                }
            },
            error: function (errorMsg) {
                alert("图表请求数据失败!");
                myChart.hideLoading();
            }
        });

        function httpPost(URL, PARAMS) {
            var temp = document.createElement("form");
            temp.action = URL;
            temp.method = "post";
            temp.style.display = "none";

            for (var x in PARAMS) {
                var opt = document.createElement("textarea");
                opt.name = x;
                opt.value = PARAMS[x];
                temp.appendChild(opt);
            }

            document.body.appendChild(temp);
            temp.submit();

            return temp;
        }

        myChart.on('click', function (param) {
            {#alert(param.name)#}
            var params = {
                "city": param.name
            };
            httpPost('/position/education/', params)
        });

    </script>
{% endblock %}
